<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<style>
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }
.main {
    width: 100%;
    max-width: 100%;
    background-color: cadetblue;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-direction: column;
    padding: 20px;
    border: 4px solid black;
}
nav {
    padding: 10px;
}
input{
    border: 2px solid black;
    padding: 2px;
}
input:hover{
    border: 2px solid green;
    background-color: khaki;
}
nav h1 {
    color:#fff;
    font-size: 30px;
    text-align: center;
}
button {
    padding: 5px 7px;
    background-color: black;
    border: 2px solid white;
    color: #fff;
}
input{
    padding: 6px;
}
button:hover{
    background-color: darkblue;
    color: #fff;
}
li {
    margin: 1px;
    list-style: none;
    padding: 10px;
    display: flex;;
    align-items: center;

}
span{
    cursor: pointer;
    color: #fff;
}
#local{
    width: 100%;
    max-width: 100%;
    display: flex;
    flex-direction: column;
    border: 4px solid black;
}
.op{
    background-color:rgb(34, 92, 97) ;
    border: 2px solid black;
    margin: 2px;
}
.op:hover{
background-color:  #a0cf60;
}
</style>
<body>
    
    <div class="main">
        <nav>
        <h1>Todo-List-Local</h1>
        <h1>Drag-Drop-List</h1></nav>
    <div><input type="text" id="inputData">
    <button onclick="fun()">ADD</button></div>
    
    </div>
    <div id="local">
        <ul id="todoList" ondrop="drop(event)" ondragover="allowDrop(event)">
        </ul>
    </div>
    <button class="op" onclick="ok()">ALL CLEAR</button>
</body>
<script>
let todoMap = new Map();
let draggedKey = null;

function loadTodos() {
    const stored = localStorage.getItem('todos');
    if (stored) {
        const todosArray = JSON.parse(stored);
        todoMap.clear();
        todosArray.forEach((item, index) => {
            todoMap.set(index, item);
        });
    }
    renderTodos();
}

function allowDrop(ev) {
    ev.preventDefault();
}

function saveTodos() {
    const todosArray = Array.from(todoMap.values());
    localStorage.setItem('todos', JSON.stringify(todosArray));
}

function renderTodos() {
    const todoList = document.getElementById('todoList');
    todoList.innerHTML = '';

    todoMap.forEach((item, key) => {
        const li = document.createElement('li');
        li.draggable = true;
        li.dataset.key = key;
        li.style.cursor = 'move';
        li.style.backgroundColor = 'rgb(34, 92, 97)';
        li.style.color = '#fff';

        const imG = document.createElement('img');
        imG.src ="./img/plus.png";
        imG.style.width = '30px';
        imG.style.marginRight = '10px';
        imG.style.color = 'white';
        li.appendChild(imG);

        const textSpan = document.createElement('span');
        textSpan.textContent = item;
        textSpan.style.flex = '1';
        textSpan.style.marginRight = '10px';
        const delBtn = document.createElement('button');
        delBtn.textContent = 'Delete';
        delBtn.onclick = function () { deleteTodo(key); };
        const img = document.createElement("img");
        img.src = "";

        delBtn.style.backgroundColor = 'darkred';
        delBtn.style.border = '2px solid white';
        delBtn.style.padding = '5px';
        delBtn.style.marginLeft = '10px';

        const editBtn = document.createElement('button');
        editBtn.textContent = 'Edit';
        editBtn.onclick = function () {
            const input = document.createElement('input');
            input.type = 'text';
            input.value = item;

            const saveBtn = document.createElement('button');
            saveBtn.textContent = 'Save';
            saveBtn.onclick = function () {
                todoMap.set(key, input.value);
                saveTodos();
                renderTodos();
            };
            li.appendChild(img);

            li.innerHTML = '';
            li.appendChild(input);
            li.appendChild(saveBtn);
        };
        editBtn.style.backgroundColor = 'darkblue';
        editBtn.style.border = '2px solid white';
        editBtn.style.padding = '5px';
        editBtn.style.marginLeft = '10px';

        li.ondragstart = dragStart;
        li.ondragover = dragOver;
        li.ondrop = dropItem;

        li.appendChild(textSpan);
        li.appendChild(delBtn);


        li.appendChild(editBtn);

        todoList.appendChild(li);
    });
}


function dragStart(ev) {
    draggedKey = ev.target.dataset.key;
}

function dragOver(ev) {
    ev.preventDefault();
}

function dropItem(ev) {
    ev.preventDefault();
    const targetKey = ev.target.dataset.key;

    if (targetKey === undefined || targetKey === draggedKey)
    return;

    const todosArray = Array.from(todoMap.values());

    const draggedItem = todosArray.splice(draggedKey, 1)[0];
    todosArray.splice(targetKey, 0, draggedItem);

    todoMap.clear();
    todosArray.forEach((value, index) => {
        todoMap.set(index, value);
    });

    saveTodos();
    renderTodos();
}

function fun() {
    const input = document.getElementById('inputData');
    const value = input.value.trim();
    if (!value) return;

    const newKey = todoMap.size;
    todoMap.set(newKey, value);
    saveTodos();
    renderTodos();
    input.value = '';
}


function deleteTodo(key) {
    todoMap.delete(key);

    const tempMap = new Map();
    let newKey = 0;
    todoMap.forEach((value) => {
        tempMap.set(newKey, value);
        newKey++;
    });
    todoMap = tempMap;
    saveTodos();
    renderTodos();
}

function ok() {
    todoMap.clear();
    localStorage.clear();
    renderTodos();
}
window.onload = loadTodos;
</script>
</html>